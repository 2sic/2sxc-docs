<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PH2TVNW');</script>
    <!-- End Google Tag Manager -->
    <!-- azing recipe embed resizer -->
    <script src="https://cdn.azing.org/e/1/embed.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Your Custom Platform - Scenario #2 - Edit Data | 2sxc 13 / EAV 13 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Your Custom Platform - Scenario #2 - Edit Data | 2sxc 13 / EAV 13 ">
    <meta name="generator" content="docfx 2.48.1.0">
    
    <link rel="shortcut icon" href="../../../assets/favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    <meta property="docfx:newtab" content="true">
  
    <!-- Enable lightboxes on all images using https://github.com/roel4ez/docfx-lightbox-plugin -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.7.13/featherlight.min.css" type="text/css" rel="stylesheet">
  
    <!-- overwrite the built in highlightJs with a newer version -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/default.min.css">
  
    <!-- fancybox -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../assets/logos/v13/2sxc13-50.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li class="active">
                          <a href="../../../basics/index.html" title="Basics">Basics</a>
                      </li>
                      <li>
                          <a href="../../../net-code/index.html" title="C# &amp; Razor">C# &amp; Razor</a>
                      </li>
                      <li>
                          <a href="../../../js-code/index.html" title="JavaScript &amp; TS">JavaScript &amp; TS</a>
                      </li>
                      <li>
                          <a href="../../../web-api/index.html" title="Web API">Web API</a>
                      </li>
                      <li>
                          <a href="../../../api/dot-net/index.html" title=".net API">.net API</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="Basics.Platforms.YourCustom.Scenario02">
<h1 id="your-custom-platform---scenario-2---edit-data">Your Custom Platform - Scenario #2 - Edit Data</h1>

<p>This is part of the <a class="xref" href="index.html">Integration Guide</a> for integrating EAV or 2sxc into your own solution. </p>
<div class="TIP"><h5>Tip</h5><p>You can find this fully implemented in the <code>Integration\SxcEdit01</code> project</p>
</div>
<div class="WARNING"><h5>Warning</h5><p>These docs are very WIP and incomplete.</p>
</div>
<h2 id="scope-of-scenario-2---edit-eav-data">Scope of Scenario #2 - Edit EAV Data</h2>
<p><strong>Functionality</strong></p>
<ol>
<li>A link on a page can open the edit dialog</li>
<li>Users can edit texts and save again</li>
<li>ADAM<ol>
<li>Users can see previously uploaded assets</li>
<li>Users can upload assets in the edit-dialog</li>
</ol>
</li>
<li>todo</li>
</ol>
<h2 id="integration-overview-for-basic-read-from-existing-db-scenarios">Integration Overview for Basic Read-From-Existing-DB Scenarios</h2>
<p>To Integrate EAV and 2sxc into your system, these are the core things you must do:</p>
<ol>
<li>Add <em>more</em> necessary DLLs</li>
<li>Copy <em>additional</em> relevant files - specifically the js/css files to be used in the dialogs</li>
<li>Implement core objects which are different in your system</li>
<li>Implement APIs for edit, probably also for delivering files etc.</li>
<li>Test / Verify you can edit data</li>
</ol>
<hr>
<h2 id="1-add-minimal-dlls">1. Add Minimal DLLs</h2>
<p>For this scenario you need to add just about all of the DLLs except for Razor helpers. </p>
<p>You can add these manually, reference them or whatever. </p>
<hr>
<h2 id="2-copy-important-web-files-to-your-target">2. Copy Important Web Files to Your Target</h2>
<p>All the dialogs are JS based, so you must get these JS files in a place where they can be loaded. </p>
<div class="TIP"><h5>Tip</h5><p>The <code>dist</code>, <code>js</code> folders etc. <strong>must</strong> be accessible from outside. </p>
</div>
<p>For reference, check out the build script on the <code>SxcEdit01</code> project. </p>
<p>TODO:</p>
<hr>
<h2 id="3-implement-core-objects-which-are-necessary">3. Implement Core Objects which are Necessary</h2>
<p>Specifically</p>
<ol>
<li>ISite</li>
<li>IUser</li>
<li></li>
</ol>
<hr>
<h2 id="4-expand-startup-configuration---todo">4. Expand StartUp Configuration - TODO:</h2>
<p>Some aspects of EAV &amp; 2sxc are super important that they are configured before anything starts. 
These are the required ones as of 2022-02:</p>
<ol>
<li>The database <strong>ConnectionString</strong> required to connect to the EAV DB</li>
<li><strong>GlobalFolder</strong> of the distributed 2sxc files containing things like the <code>.data</code> subfolder - required to load initial configurations and initial data</li>
<li>Call <code>StartUp</code> on the <code>SystemLoader</code> which you must get from DI</li>
</ol>
<p>This is the working code taken from <code>BasicEav01</code>:</p>
<pre><code class="lang-c#">/// &lt;summary&gt;
/// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
/// &lt;/summary&gt;
public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
  // ----- Start EAV stuff #2sxcIntegration -----
  var serviceProvider = app.ApplicationServices;

  // Set Connection String
  serviceProvider.Build&lt;IDbConfiguration&gt;().ConnectionString = _connStringFromConfig;

  // Set global path where it will find the .data folder
  var globalConfig = serviceProvider.Build&lt;IGlobalConfiguration&gt;();
  globalConfig.GlobalFolder = Path.Combine(env.ContentRootPath, &quot;sys-2sxc&quot;);

  // Trigger start where the data etc. will be loaded &amp; initialized
  serviceProvider.Build&lt;SystemLoader&gt;().StartUp();
  // ----- End EAV stuff #2sxcIntegration -----

  // ...
}
</code></pre><hr>
<h2 id="5-test-and-verify">5. Test and Verify</h2>
<p>If you did everything right, you can now run your code and access data from the App Cache using code like this (see demo on the <code>ShowEavData.cshtml</code>):</p>
<pre><code class="lang-c#">@page
@using ToSic.Eav.Apps
@inject IAppStates AppStates
@{
  ViewData[&quot;Title&quot;] = &quot;First Read Data from EAV&quot;;

  // Adjust these values to your testing environment
  var zoneId = 2;
  var appId = 78;

  var appState = AppStates.Get(new AppIdentity(zoneId, appId));
  var firstItem = appState.List.FirstOrDefault();
}
</code></pre><p><strong>Common Problems</strong></p>
<ol>
<li>If the folder to the <code>.data</code> isn&#39;t quite correct, you will have a long loading time and then a stack overflow</li>
</ol>
<hr>
<h2 id="5-get-insights-webapi-to-work">5. Get Insights WebApi to Work</h2>
<p>The <a class="xref" href="../../../net-code/debug/insights.html">Insights</a> will help you figure out what parts you need to implement. 
It will show you what services were requested which are not implemented yet, and will show you what code was used. </p>
<ol>
<li>Create your minimal <code>InsightsController</code> as you see in the demo project</li>
<li>Register the routes using whatever system you have ATM (.net core, ASP.net Framework)</li>
<li>Test the routes to see things are coming out</li>
</ol>
<p><strong>Minimal <code>InsightsController</code></strong></p>
<pre><code class="lang-c#">using Microsoft.AspNetCore.Mvc;
using ToSic.Eav.Logging.Simple;
using ToSic.Eav.WebApi.Sys;

namespace IntegrationSamples.BasicEav01.Controllers
{
    [Route(&quot;api/sxc/sys/[controller]&quot;)]
    [ApiController]
    public class InsightsController : ControllerBase
    {
        /// &lt;summary&gt;
        /// Constructor which will retrieve the Insights backend for use here
        /// &lt;/summary&gt;
        public InsightsController(Insights insights) =&gt; _insights = insights;
        private readonly Insights _insights;

        /// &lt;summary&gt;
        /// The main call on this controller, will return all kinds of views with information
        /// &lt;/summary&gt;
        [HttpGet(&quot;{view}&quot;)]
        public ContentResult Details(
            [FromRoute] string view,
            [FromQuery] int? appId = null, 
            [FromQuery] string key = null, 
            [FromQuery] int? position = null,
            [FromQuery] string type = null,
            [FromQuery] bool? toggle = null,
            [FromQuery] string nameId = null)
        {
            // Temporary setting to allow Insights despite minimal setup
            ToSic.Eav.Context.UserUnknown.AllowEverything = true;

            var result = _insights
                .Init(new Log(&quot;Int.Insights&quot;))
                .Details(view, appId, key, position, type, toggle, nameId);
            return base.Content(result, &quot;text/html&quot;);
        }
    }
}
</code></pre><p><strong>Activate it in the <code>StartUp.cs</code></strong></p>
<pre><code class="lang-c#">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
  // ...

  app.UseEndpoints(endpoints =&gt;
  {
      endpoints.MapRazorPages();

      // #2sxcIntegration - enable insights controllers
      endpoints.MapControllers();
  });
}
</code></pre><p>Test by calling <code>https://localhost:44384/api/sxc/sys/Insights/Help</code> - replace the base path as needed</p>
<hr>
<h2 id="history">History</h2>
<ul>
<li>Proof of Concept implemented with 2sxc 11 in 2021</li>
<li>Finalized when integrating Oqtane in 2sxc 12</li>
<li>Updated docs for basic Scenario for v13.03</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/2sic/2sxc-docs/blob/master/2sxc Docs Generator/basics/platforms/your-custom/scenario-02.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    
    <!-- override the built-in highlightjs with a newer version -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
    <script src="../../../styles/cshtml-razor.js"></script>
    <script>
        hljs.registerLanguage('cshtml-razor', window.hljsDefineCshtmlRazor);
        hljs.initHighlightingOnLoad();
    </script>
    
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.7.13/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="../../../styles/2sxc-scripts.js"></script>
    
    <!-- fancybox -->
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>  </body>
</html>
