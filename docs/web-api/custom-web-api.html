<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PH2TVNW');</script>
    <!-- End Google Tag Manager -->
    <!-- azing recipe embed resizer -->
    <script src="https://cdn.azing.org/e/1/embed.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>2sxc Custom C# Web APIs | 2sxc and EAV 10 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="2sxc Custom C# Web APIs | 2sxc and EAV 10 ">
    <meta name="generator" content="docfx 2.48.1.0">
    
    <link rel="shortcut icon" href="../images/logos/v11/favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logos/v11/2sxc50.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../specs/index.html" title="Specs">Specs</a>
                      </li>
                      <li>
                          <a href="../how-to/index.html" title="How To">How To</a>
                      </li>
                      <li>
                          <a href="../web-api/index.html" title="Web API">Web API</a>
                      </li>
                      <li>
                          <a href="../api/dot-net/index.html" title=".net API">.net API</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="WebApi.Custom">
<h1 id="2sxc-custom-c-web-apis">2sxc Custom C# Web APIs</h1>

<p>You can easily create custom C# WebAPIs, and then access them from JavaScript or anywhere. What these endpoints do is completely up to you.</p>
<div class="TIP"><h5>Tip</h5><p><strong>Discover this Feature</strong><br>Before you spend too much time reading docs, best discover this live. 
You can find a real-life example in our <a class="xref" href="https://2sxc.org/dnn-tutorials/en/razor/webapi/home">Razor-Tutorials</a>. </p>
</div>
<h2 id="how-to-access-the-endpoints-with-javascript">How to Access the Endpoints with JavaScript</h2>
<p>You can find a good example on <a class="xref" href="https://2sxc.org/dnn-tutorials/en/razor/webapi/home">live tutorials</a> or in the <a class="xref" href="(xref:App.Mobius)">Mobius Forms App</a>. Calling these is as follows:</p>
<ul>
<li><code>.../app/auto/api/[YourName]</code> when accessing a WebApi of the current app (from a dnn-page with this module), as then 2sxc uses auto-detect</li>
<li><code>.../app/[app-folder]/api/[YourName]</code> when using this endpoint from external, as auto-detect can&#39;t work then.</li>
</ul>
<p>Most WebApi Actions will require additional parameters. Just add them as url-parameters like <code>?param1=This&amp;param2=That</code></p>
<h2 id="where-to-store-the-api-files">Where to Store the API Files</h2>
<p>All your WebAPIs are C# files saved in the special folder called <code>api</code>. The folder must be in root of your 2sxc app, and the files have to end with <code>...Controller.cs</code> (this is a convention in ASP.net).</p>
<ul>
<li>classic (single edition)<br><code>[app-folder]/api/YourController.cs</code><br>accessed url: <code>[api-root]/app/auto/api/[Your]</code></li>
</ul>
<p><em>New in 2sxc 9.35+</em>: you can now also create <code>api</code> folders as <em>subfolders</em> to run the api in multiple editions. This is the <a class="xref" href="../specs/cms/polymorph.html">polymorph feature</a>. 
It let&#39;s you have the <strong>same</strong> api-controller in multiple editions, where the end-user is using <code>live</code> and you&#39;re doing open-heart-surgery in the background on a new edition like <code>staging</code>. </p>
<ul>
<li>multiple editions:<br><code>[app-folder]/[edition]/api/YourController.cs</code>
access url: <code>[api-root]/app/auto/[edition]/api/[Your]</code></li>
</ul>
<p>Read more about urls in the <a class="xref" href="index.html">WebApi</a> docs.</p>
<h2 id="basic-example">Basic Example</h2>
<p>A file in your app in the <code>api</code> folder called <code>BooksController.cs</code> could look like the following:</p>
<pre><code class="lang-c#">using DotNetNuke.Security;
using DotNetNuke.Web.Api;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Web.Http;

public class BooksController : ToSic.Sxc.Dnn.ApiController
{
  [HttpGet]
  [DnnModuleAuthorize(AccessLevel = SecurityAccessLevel.Anonymous)]
  [ValidateAntiForgeryToken]
  public object Persons()
  {
    return new ToSic.Sxc.Conversion.DataToDictionary(Edit.Enabled)
      .Convert(App.Data[&quot;Persons&quot;]);
  }
}
</code></pre><p>The custom controller <strong>BooksController</strong> must have the same name as the file and extends the <strong>ApiController</strong> controller. It has a method returning all items of the <strong>Persons</strong> data type. The method is decorated with several attributes:</p>
<ul>
<li><code>[HttGet]</code> defines that the method must be invoked with HTTP GET</li>
<li><code>[DnnModuleAuthorize(AccessLevel = ...)]</code> defines the permission an invoker must have</li>
<li><code>[ValidateAntiForgeryToken]</code> ensures that a security token from the cookies is validated before the mehod is invoked</li>
</ul>
<p>The custom controller can be called with JavaScript like this:</p>
<pre><code class="lang-html">&lt;!-- this ensures the $2sxc scripts are loaded --&gt;
@Edit.Enable(js: true)

&lt;!-- the button which loads everything --&gt;
&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; onclick=&quot;getPersons(this)&quot;&gt;
  Get Persons Custom
&lt;/button&gt; 


&lt;script&gt;
  // this script does the API call and then shows the result
  function getPersons(moduleContext) {
    $2sxc(moduleContext)
      .webApi.get(&#39;app/auto/api/books/persons&#39;)
      .then(function (results) {
        alert(&#39;Found &#39; + results.length + &#39; persons. \n&#39;
          + &#39;The first one is &quot;&#39; + results[0].FirstName + &#39; &#39; + results[0].LastName + &#39;&quot;\n\n&#39;
          + &#39;The raw JSON: \n&#39; + JSON.stringify(results)
        );
      });
  }
&lt;/script&gt;
</code></pre><p>The $2sxc API ensures that the GET request is send to the correct url <code>/DesktopModules/2sxc/API/app/auto/api/Books/Persons</code>. You can also read more about the <a class="xref" href="../specs/js/sxc.html">sxc Controller</a>.</p>
<h2 id="special-object--commands-in-apicontroller">Special Object / Commands in ApiController</h2>
<p>The <code>ApiController</code> provides various command / helpers to get you productiv. Most are the same as in a normal Razor view, but some are additional. Here are the main ones:</p>
<ol>
<li>AsDynamic(...)</li>
<li>AsList(...)</li>
<li>AsEntity(...)</li>
<li><a class="xref" href="../how-to/dynamic-code/object-dnn.html">Dnn</a></li>
<li><a class="xref" href="../how-to/dynamic-code/object-app.html">App</a> with <code>App.Data</code>, <code>App.Query</code> etc.</li>
<li><a class="xref" href="../how-to/dynamic-code/object-data.html">Data</a></li>
<li><a class="xref" href="custom-web-api-dotnet-saveinadam.html">SaveInAdam(...)</a> <em>new in 9.30</em></li>
</ol>
<h2 id="security">Security</h2>
<p>Your C# code determines what security is applied, and what http verbs are supported. For now, read up on DNN WebApi controllers to figure how to best do this. In most cases you&#39;ll add attributes like</p>
<ul>
<li><code>[AllowAnonymous]</code></li>
<li><code>[DnnModuleAuthorize(AccessLevel = SecurityAccessLevel.Anonymous)]</code></li>
<li><code>[ValidateAntiForgeryToken]</code> - this forces the API to only work when called from JavaScript on the same site (no external use)</li>
</ul>
<h2 id="notes">Notes</h2>
<ul>
<li>Instead of <strong>App.Data[&quot;MyData&quot;]</strong> you can fetch data from another data source provided by 2sxc (for exmple from the <strong>App.Query[&quot;MyQueryData&quot;]</strong>)</li>
<li><strong>Sxc.Serializer.Prepare(...)</strong> converts the object returned by App.Data[&quot;MyData&quot;].List to a dynamic and serializable object</li>
</ul>
<h2 id="recommended-reading">Recommended Reading</h2>
<ul>
<li><a class="xref" href="https://2sxc.org/dnn-tutorials/en/razor/webapi/home">Web API Tutorials</a></li>
<li><a class="xref" href="index.html">WebApi</a></li>
<li><a class="xref" href="../specs/cms/polymorph.html">Concepts: Polymorphisms</a></li>
</ul>
<h2 id="history">History</h2>
<ol>
<li>Introduced in 2sxc 06.05</li>
<li>Enhanced with Polymorph Editions in 2sxc 9.35 (allowing subfolder/api)</li>
</ol>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/2sic/2sxc-docs/blob/master/src/web-api/custom-web-api.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
